<ul class="flex items-center gap-x-3">
  <li>
    <ps-battery class="w-4 xl:w-5" level="35" />
  </li>
  <li>
    <button
      #wifiTrigger="cdkOverlayOrigin"
      class="flex cursor-pointer items-center rounded-sm transition-colors hover:bg-black/10"
      cdkOverlayOrigin
      data-testid="wifiMenuButton"
      type="button"
      (click)="toggleWifiMenu()"
    >
      <ps-icon class="w-4" icon="wifi" />
    </button>
  </li>
  <li>
    <button
      #bluetoothTrigger="cdkOverlayOrigin"
      class="flex cursor-pointer items-center rounded-sm transition-colors hover:bg-black/10"
      cdkOverlayOrigin
      data-testid="bluetoothMenuButton"
      type="button"
      (click)="toggleBluetoothMenu()"
    >
      <ps-icon class="w-3 xl:w-3" icon="bluetooth" />
    </button>
  </li>
</ul>

<ng-template
  cdkConnectedOverlay
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  [cdkConnectedOverlayOrigin]="bluetoothTrigger"
  [cdkConnectedOverlayOpen]="isBluetoothMenuOpen()"
  [cdkConnectedOverlayHasBackdrop]="true"
  [cdkConnectedOverlayOffsetY]="8"
  (backdropClick)="closeBluetoothMenu()"
>
  <div
    class="bg-background border-window-border min-w-[220px] rounded-md border-2 border-solid shadow-lg"
    data-testid="bluetoothMenuDropdown"
  >
    <div
      class="text-window-border border-window-border border-b-2 px-4 py-2 text-sm font-bold"
    >
      Bluetooth Devices
    </div>
    <ul class="py-1">
      @for (device of bluetoothDevices; track device.name) {
        <li>
          <button
            class="text-window-border flex w-full items-center justify-between gap-x-3 px-4 py-2 text-left text-sm hover:bg-black/10"
            [attr.data-testid]="'bluetoothDevice-' + device.name"
            type="button"
            (click)="connectDevice(device.name)"
          >
            <span class="flex-1">{{ device.name }}</span>
            <div class="flex items-center gap-x-2">
              <span
                class="text-xs"
                [ngClass]="getBatteryColor(device.batteryLevel)"
              >
                {{ device.batteryLevel }}%
              </span>
              <ps-battery class="w-4 xl:w-5" [level]="device.batteryLevel" />
            </div>
          </button>
        </li>
      }
    </ul>
  </div>
</ng-template>

<ng-template
  cdkConnectedOverlay
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  [cdkConnectedOverlayOrigin]="wifiTrigger"
  [cdkConnectedOverlayOpen]="isWifiMenuOpen()"
  [cdkConnectedOverlayHasBackdrop]="true"
  [cdkConnectedOverlayOffsetY]="8"
  (backdropClick)="closeWifiMenu()"
>
  <div
    class="bg-background border-window-border min-w-[240px] rounded-md border-2 border-solid shadow-lg"
    data-testid="wifiMenuDropdown"
  >
    <div
      class="text-window-border border-window-border border-b-2 px-4 py-2 text-sm font-bold"
    >
      WiFi Networks
    </div>
    <ul class="py-1">
      @for (network of wifiNetworks; track network.name) {
        <li>
          <button
            class="text-window-border flex w-full items-center justify-between gap-x-3 px-4 py-2 text-left text-sm hover:bg-black/10"
            [attr.data-testid]="'wifiNetwork-' + network.name"
            type="button"
            (click)="connectNetwork(network.name)"
          >
            <span class="flex-1">{{ network.name }}</span>
            <div class="flex items-center gap-x-2">
              <span
                class="text-xs"
                [ngClass]="getSignalColor(network.signalStrength)"
              >
                {{ network.signalStrength }}%
              </span>

              @if (network.locked) {
                <ps-icon class="-mt-0.5 w-3" icon="lock" />
              }
            </div>
          </button>
        </li>
      }
    </ul>
  </div>
</ng-template>
