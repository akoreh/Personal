<div
  #windowElement
  class="pointer-events-auto absolute flex min-h-96 min-w-96 flex-col"
  cdkDrag
  [ngClass]="{
    hidden: minimized(),
    'inset-0': maximized(),
    'max-h-[80vh] max-w-[80vw]': !maximized(),
  }"
  [style.z-index]="zIndex()"
  [cdkDragFreeDragPosition]="initialPosition()"
  [cdkDragDisabled]="maximized()"
  [cdkDragBoundary]="dragBoundary()"
  (click)="onFocus()"
  (mousedown)="onFocus()"
>
  <div
    class="border-window-border relative z-20 flex flex-1 flex-col overflow-hidden rounded-xl border-[3px] border-solid"
  >
    <div
      class="bg-primary-red border-window-border flex h-6 w-full border-b-2 border-solid px-1"
      cdkDragHandle
      data-testid="windowToolbar"
    >
      <div class="flex flex-1 items-center justify-center">
        @if (title()) {
          <span class="text-sm">
            {{ title() }}
          </span>
        }
      </div>

      @if (hasControls()) {
        <div class="flex h-full items-center gap-1">
          @if (minimizable()) {
            <button
              class="rounded px-1 hover:bg-black/10"
              type="button"
              (click)="onMinimize($event)"
            >
              <ps-icon class="h-4 w-4" icon="minus" />
            </button>
          }
          @if (maximizable()) {
            <button
              class="rounded px-1 hover:bg-black/10"
              type="button"
              (click)="onMaximize($event)"
            >
              @if (maximized()) {
                <ps-icon class="h-4 w-4" icon="arrows-pointing-in" />
              } @else {
                <ps-icon class="h-4 w-4" icon="arrows-pointing-out" />
              }
            </button>
          }
          @if (closable()) {
            <button
              class="rounded px-1 hover:bg-black/10"
              type="button"
              (click)="onClose($event)"
            >
              <ps-icon class="h-4 w-4" icon="x-mark" />
            </button>
          }
        </div>
      }
    </div>

    <div class="bg-window-light flex flex-1 overflow-auto">
      <ng-container *ngComponentOutlet="component()" />
    </div>
  </div>

  <div
    class="bg-window-border pointer-events-none absolute left-1.5 top-1.5 z-10 h-full w-full rounded-xl"
  ></div>
</div>
